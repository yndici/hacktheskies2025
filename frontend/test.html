<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Cesium Simple Test - Final Fix</title>
    <link href="https://cesium.com/downloads/cesiumjs/releases/1.117/Build/Cesium/Widgets/widgets.css" rel="stylesheet">
    <script src="https://cesium.com/downloads/cesiumjs/releases/1.117/Build/Cesium/Cesium.js"></script>
</head>
<body>
    <div id="cesiumContainer" style="width: 100%; height: 100vh;"></div>
    <script>
        // 1. You must keep your NEW, VALID TOKEN here. (It allows geocoding to work).
        Cesium.Ion.defaultAccessToken = 'YOUR_NEW_VALID_CESIUM_ION_TOKEN';
        
        // 2. Define the OpenStreetMap provider
        const osmProvider = new Cesium.OpenStreetMapImageryProvider({
            url : 'https://a.tile.openstreetmap.org/',
            fileExtension: 'png',
        });

        const viewer = new Cesium.Viewer('cesiumContainer', {
            // CRUCIAL CHANGE: We must disable the BaseLayerPicker
            // AND ensure the imageryLayers collection is clear.
            
            // Set BaseLayerPicker to false so it doesn't try to load the Ion default layers
            baseLayerPicker: false, 
            
            // Start the viewer with a dummy provider, or false.
            imageryProvider: new Cesium.UrlTemplateImageryProvider({ url: 'about:blank' }), 
            
            // Use a simple ellipsoid terrain (no complex Ion requests)
            terrainProvider: new Cesium.EllipsoidTerrainProvider(), 
            
            animation: false,
            timeline: false,
            // We need the Geocoder for your search function, which is now working.
            // geocoder: false, // Keep this off if you don't need the UI search box
        });

        // 3. CRUCIAL FIX: MANUALLY ADD THE OSM LAYER
        // Remove all default layers, then add the one you want.
        viewer.imageryLayers.removeAll(); 
        viewer.imageryLayers.addImageryProvider(osmProvider);

        // Zoom out to global view
        viewer.camera.flyTo({
            destination: Cesium.Cartesian3.fromDegrees(0, 0, 10000000), 
            duration: 0
        });
    </script>
</body>
</html>